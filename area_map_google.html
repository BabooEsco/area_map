<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mappa Satellitare con Google Maps API</title>
    <style>
        #map { height: 100vh; width: 100%; }
        #info { font-family: Arial, sans-serif; padding: 10px; }
    </style>
</head>
<body>
    <div id="info"><strong>Disegna un poligono sulla mappa per calcolare l'area.</strong></div>
    <div id="map"></div>

    <!-- Includi la Google Maps API con la libreria di disegno e geometria -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDnAh5tcwVLCL6VS0m-dvLNv7fq5NO1MJA&libraries=geometry,drawing"></script>
    <script>
        let map;
        let drawingManager;
        let selectedShape;

        function initMap() {
            // Crea una mappa centrata sull'Italia con il layer satellitare
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 41.9028, lng: 12.4964 }, // Roma, Italia
                zoom: 6,
                mapTypeId: 'satellite' // Imposta la vista satellitare
            });

            // Inizializza il Drawing Manager
            drawingManager = new google.maps.drawing.DrawingManager({
                drawingMode: google.maps.drawing.OverlayType.POLYGON,
                drawingControl: true,
                drawingControlOptions: {
                    position: google.maps.ControlPosition.TOP_CENTER,
                    drawingModes: ['polygon']
                },
                polygonOptions: {
                    fillColor: '#FF0000',
                    fillOpacity: 0.35,
                    strokeWeight: 2,
                    clickable: true,
                    editable: true,
                    zIndex: 1
                }
            });
            drawingManager.setMap(map);

            // Evento di completamento disegno
            google.maps.event.addListener(drawingManager, 'overlaycomplete', function(event) {
                if (event.type === google.maps.drawing.OverlayType.POLYGON) {
                    // Rimuovi eventuali poligoni precedenti
                    if (selectedShape) {
                        selectedShape.setMap(null);
                    }
                    selectedShape = event.overlay;

                    // Calcola e visualizza l'area del poligono
                    const area = google.maps.geometry.spherical.computeArea(selectedShape.getPath());
                    const infoContent = "Area: " + area.toFixed(2) + " metri quadrati";
                    document.getElementById("info").innerHTML = infoContent;
                    
                    // Rendi il poligono modificabile e aggiorna l'area quando viene cambiato
                    google.maps.event.addListener(selectedShape.getPath(), 'set_at', calculateArea);
                    google.maps.event.addListener(selectedShape.getPath(), 'insert_at', calculateArea);
                }
            });
        }

        // Funzione per calcolare l'area del poligono
        function calculateArea() {
            if (selectedShape) {
                const area = google.maps.geometry.spherical.computeArea(selectedShape.getPath());
                document.getElementById("info").innerHTML = "Area: " + area.toFixed(2) + " metri quadrati";
            }
        }

        // Inizializza la mappa
        window.initMap = initMap;
    </script>
</body>
</html>
